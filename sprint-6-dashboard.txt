================================================================================
SPRINT 6: UNIVERSAL ANALYTICS DASHBOARD & SNAKE GAME IMPROVEMENTS
================================================================================

This document explains the reusable analytics system implemented for WordWyrm
and all improvements made to the Snake game during Sprint 6.

================================================================================
1. UNIVERSAL ANALYTICS DASHBOARD - HOW IT WORKS
================================================================================

OVERVIEW:
We created a configuration-driven analytics system that works for ALL game types
(Snake, Tower Defense, Traditional, future games) WITHOUT requiring changes to
the dashboard code when adding new games.

THE SYSTEM HAS 3 MAIN PARTS:

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. GAME TYPE REGISTRY (lib/game-types.ts)                                  ‚îÇ
‚îÇ    - Defines what metrics each game type tracks                            ‚îÇ
‚îÇ    - Example: Snake tracks "longestStreak"                                 ‚îÇ
‚îÇ    - Tower Defense might track "wavesCompleted", "towersBuilt"             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. METADATA STORAGE (Database)                                             ‚îÇ
‚îÇ    - GameSession.metadata field stores game-specific stats as JSON         ‚îÇ
‚îÇ    - Universal fields: score, correctAnswers, totalQuestions, timeSpent    ‚îÇ
‚îÇ    - Game-specific data goes in metadata JSON field                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. DYNAMIC DASHBOARD (app/teacher/analytics/[gameId]/page.tsx)             ‚îÇ
‚îÇ    - Reads game.gameMode from database                                     ‚îÇ
‚îÇ    - Looks up config from game-types.ts                                    ‚îÇ
‚îÇ    - Automatically renders columns based on config                         ‚îÇ
‚îÇ    - NO CODE CHANGES needed when adding new games!                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


DATA FLOW:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Game Ends    ‚îÇ ---> ‚îÇ Save Session ‚îÇ ---> ‚îÇ Database     ‚îÇ ---> ‚îÇDashboard ‚îÇ
‚îÇ (SnakeScene) ‚îÇ      ‚îÇ with metadata‚îÇ      ‚îÇ (JSON field) ‚îÇ      ‚îÇ(Displays)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  Tracks stats      saveGameSession()      Stores flexible      Reads config
                                            game data            + renders

WHAT THE DASHBOARD DISPLAYS:

Universal Columns (same for all games):
  ‚Ä¢ Student Name
  ‚Ä¢ Score
  ‚Ä¢ Correct Answers (e.g., "3/10")
  ‚Ä¢ Accuracy (e.g., "75%")

Dynamic Columns (from game-types.ts config):
  ‚Ä¢ Snake: Longest Streak
  ‚Ä¢ Tower Defense: Waves Completed, Towers Built, Enemies Defeated (example)
  ‚Ä¢ Traditional: Accuracy, Avg Time/Question
  ‚Ä¢ Future games: Whatever metrics you configure!


================================================================================
2. HOW TO ADD A NEW GAME TYPE TO ANALYTICS
================================================================================

FOR DEVELOPERS WORKING ON OTHER GAME TYPES (Tower Defense, etc.):

STEP 1: Add your game's configuration to lib/game-types.ts
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

TOWER_DEFENSE: {
  name: 'Tower Defense Quiz',
  description: 'Answer questions to build towers and defend',
  metrics: [
    {
      key: 'wavesCompleted',      // Key in metadata JSON
      label: 'Waves Completed',   // Column header in dashboard
      type: 'number'
    },
    {
      key: 'towersBuilt',
      label: 'Towers Built',
      type: 'number'
    }
  ]
}

STEP 2: In your game code, save the session when game ends
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

import { saveGameSession } from '@/app/actions/game';

// When game ends:
await saveGameSession({
  gameId: this.gameId,
  score: this.score,
  correctAnswers: this.correctAnswers,
  totalQuestions: this.totalQuestions,
  timeSpent: timeInSeconds,
  metadata: {
    wavesCompleted: this.wavesCompleted,    // Must match key in config
    towersBuilt: this.towersBuilt           // Must match key in config
  }
});

STEP 3: That's it!
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
The analytics dashboard will automatically work. No changes needed to the
dashboard code. Just add your config and save your metadata.


================================================================================
3. FILES MODIFIED IN THIS SPRINT
================================================================================

DATABASE SCHEMA:
  üìÑ prisma/schema.prisma
     - Added metadata Json? field to GameSession model
     - Stores game-specific statistics flexibly

GAME TYPE CONFIGURATION:
  üìÑ lib/game-types.ts (NEW FILE)
     - GAME_TYPES registry mapping GameMode to metrics
     - Snake config: tracks longestStreak only
     - Tower Defense config: placeholder for your team to update
     - getGameTypeConfig() helper function

SERVER ACTIONS:
  üìÑ app/actions/game.ts
     - saveGameSession() function (NEW)
     - Saves/updates game sessions with metadata
     - Uses upsert: updates if student played before

SNAKE GAME (ANALYTICS INTEGRATION):
  üìÑ lib/phaser/SnakeScene.ts
     - Added gameId tracking
     - Added longestStreak tracking
     - Added startTime tracking
     - saveSession() method calls saveGameSession()
     - Exit button now navigates to /student/dashboard
     - Fixed correct answer flow to show "Read the question" screen
     - Fixed exit button to be clickable on win screen

  üìÑ components/game/SnakeGame.tsx
     - Added gameId prop
     - Passes gameId to SnakeScene via scene.start()

  üìÑ app/play/snake/page.tsx
     - Passes gameId from URL params to SnakeGame component

ANALYTICS DASHBOARD:
  üìÑ app/teacher/analytics/[gameId]/page.tsx (NEW FILE)
     - Universal analytics dashboard for all game types
     - Fetches game + sessions from database
     - Calls getGameTypeConfig() to get metrics
     - Dynamically renders table columns
     - Shows summary stats (total players, avg score, avg accuracy)

GAME ROUTING:
  üìÑ app/play/phaser/[shareCode]/page.tsx
     - Changed from hardcoded Tower Defense to dynamic router
     - Checks game.gameMode and redirects appropriately
     - Snake -> /play/snake?gameId=...
     - Tower Defense -> /play/td?gameId=...

TEACHER DASHBOARD (ANALYTICS BUTTON):
  üìÑ components/dashboard/GamesView.tsx
     - Added handleViewAnalytics() function
     - Passes onViewAnalytics to GameCard components

  üìÑ components/dashboard/GameCard.tsx
     - Added onViewAnalytics prop
     - Added "View Analytics" button in three-dot menu
     - Button only shows for published games (not drafts)
     - Uses BarChart3 icon from lucide-react


================================================================================
4. SNAKE GAME FIXES
================================================================================

FIX #1: Game Routing
  PROBLEM: Share codes always loaded Tower Defense
  SOLUTION: Made router check gameMode and redirect to correct game
  FILE: app/play/phaser/[shareCode]/page.tsx

FIX #2: Correct Answer Flow
  PROBLEM: Correct answers skipped "read the question" screen
  SOLUTION: Rewrote showCorrectFeedback() to match wrong answer flow
  FILE: lib/phaser/SnakeScene.ts

FIX #3: Exit Button Not Clickable
  PROBLEM: Exit button disabled on win screen
  SOLUTION: Re-enable interactive on winGame()
  FILE: lib/phaser/SnakeScene.ts

FIX #4: Exit Button Wrong Navigation
  PROBLEM: Exit used window.history.back() (went back to game)
  SOLUTION: Changed to window.location.href = '/student/dashboard'
  FILE: lib/phaser/SnakeScene.ts

FIX #5: Simplified Analytics Metrics
  PROBLEM: Redundant columns (correctAnswers, totalQuestions, finalLength)
  SOLUTION: Removed redundant metrics, kept only longestStreak
  FILE: lib/game-types.ts


================================================================================
5. HOW TEACHERS ACCESS ANALYTICS
================================================================================

STEP 1: Teacher goes to dashboard
STEP 2: Find a published game (not a draft)
STEP 3: Click the three-dot menu on the game card
STEP 4: Click "View Analytics"
STEP 5: See dashboard with all student results


================================================================================
6. TESTING CHECKLIST
================================================================================

[ ] Create a Snake game as a teacher
[ ] Share the game with students (use share code or QR code)
[ ] Play the game as a student
[ ] Check that session is saved (no errors in console)
[ ] Go to teacher dashboard
[ ] Click three-dot menu on the game
[ ] Click "View Analytics"
[ ] Verify data shows correctly:
    - Total players count
    - Average score
    - Average accuracy
    - Student name
    - Score
    - Correct Answers (X/Y format)
    - Accuracy percentage
    - Longest Streak
[ ] Verify "Longest Streak" column exists (no N/A)
[ ] Verify NO redundant columns (no extra "Questions Correct")


================================================================================
7. IMPORTANT NOTES FOR COLLABORATORS
================================================================================

FOR TOWER DEFENSE DEVELOPER:
  ‚ö†Ô∏è  Update lib/game-types.ts with your actual metrics
  ‚ö†Ô∏è  Call saveGameSession() when your game ends
  ‚ö†Ô∏è  The dashboard will automatically work - no changes needed to dashboard code

FOR FUTURE GAME DEVELOPERS:
  ‚úì  Add your game mode to Prisma schema (GameMode enum)
  ‚úì  Add configuration to lib/game-types.ts
  ‚úì  Save metadata when game ends
  ‚úì  Dashboard automatically adapts!

ARCHITECTURE DECISIONS:
  ‚Ä¢ Used JSON field for flexibility (no migrations when adding metrics)
  ‚Ä¢ Configuration-driven for extensibility (no dashboard code changes)
  ‚Ä¢ Server actions for security (database writes from server only)
  ‚Ä¢ Dynamic rendering for reusability (one dashboard for all games)

SEARCH TAGS:
  All analytics code is tagged with "ANALYTICS SYSTEM" in comments
  Use Ctrl+F to find: "ANALYTICS SYSTEM"


================================================================================
8. DEMO MODE vs TRACKED MODE
================================================================================

DEMO MODE (no gameId):
  ‚Ä¢ Game runs without analytics
  ‚Ä¢ No session saved to database
  ‚Ä¢ Used for testing without affecting analytics

TRACKED MODE (with gameId):
  ‚Ä¢ Game receives gameId from URL params
  ‚Ä¢ Session saved when game ends
  ‚Ä¢ Analytics appear in teacher dashboard


================================================================================
END OF SPRINT 6 SUMMARY
================================================================================

