# Phaser Editor Integration Guide

## Testing Your Scene in Phaser Editor

### Method 1: Quick Preview (Recommended)
1. **Open UIScene.scene** in Phaser Editor
2. Click the **"Play"** button in the toolbar (or press `F12`)
3. The scene will open in a preview window

### Method 2: Browser Preview
1. Right-click on `UIScene.scene` → **"Open Scene in Browser"**
2. This opens a full browser preview with dev tools

### Method 3: Integrated Preview
1. In Phaser Editor, go to **Window** → **Preview**
2. Select your scene from the dropdown
3. The preview updates live as you edit

---

## Connecting UI Scene to Game Logic

Your UIScene is currently visual-only. Here's how to connect it to your game:

### Step 1: Generate TypeScript from Scene

After editing in Phaser Editor:
1. **Save** your UIScene.scene file
2. Phaser Editor automatically generates `UIScene.ts`
3. This TypeScript file contains all your UI elements as properties

### Step 2: Add Event Handlers

The UIScene.ts file should have an `editorCreate()` method. Add your event handlers in the `create()` method:

```typescript
// In UIScene.ts
export default class UIScene extends Phaser.Scene {
  // Properties auto-generated by Phaser Editor
  public livesText!: Phaser.GameObjects.Text;
  public goldText!: Phaser.GameObjects.Text;
  public waveButton!: Phaser.GameObjects.Rectangle;
  // ... etc

  constructor() {
    super("UIScene");
  }

  editorCreate(): void {
    // Auto-generated UI creation code
    // DO NOT EDIT THIS METHOD - it's regenerated by Phaser Editor
  }

  create() {
    this.editorCreate();

    // ADD YOUR EVENT HANDLERS HERE
    this.setupEventHandlers();
  }

  setupEventHandlers() {
    // Example: Wave button click
    this.waveButton.setInteractive();
    this.waveButton.on('pointerdown', () => {
      // Get reference to game scene
      const gameScene = this.scene.get('TowerDefenseScene');
      // Call game method
      gameScene.events.emit('startWave');
    });

    // Example: Tower button click
    this.ballistaButton.setInteractive();
    this.ballistaButton.on('pointerdown', () => {
      this.scene.get('TowerDefenseScene').events.emit('selectTower', 'basic');
    });
  }

  // Method to update UI from game state
  updateDisplay(gold: number, lives: number, waveNumber: number) {
    this.goldText.setText(`Gold: ${gold}`);
    this.livesText.setText(`Lives: ${lives}`);
    this.waveCounterText.setText(`Round ${waveNumber}`);
  }
}
```

### Step 3: Connect from Game Scene

In your TowerDefenseScene.ts:

```typescript
export default class TowerDefenseScene extends Phaser.Scene {
  private uiScene: any;

  create() {
    // Launch UI scene as overlay
    this.scene.launch('UIScene');
    this.uiScene = this.scene.get('UIScene');

    // Listen to UI events
    this.events.on('startWave', this.startWave, this);
    this.events.on('selectTower', this.selectTower, this);

    // Update UI when game state changes
    this.updateUI();
  }

  update() {
    // Regular game loop
    this.updateUI();
  }

  updateUI() {
    if (this.uiScene && this.uiScene.updateDisplay) {
      this.uiScene.updateDisplay(this.gold, this.lives, this.waveNumber);
    }
  }
}
```

---

## Testing Full Game in Phaser Editor

### Option 1: Create a Main Scene

Create a new scene that loads both UIScene and TowerDefenseScene:

1. **In Phaser Editor**: File → New → Scene
2. Name it "MainScene.scene"
3. In the scene's create method, launch both scenes:

```typescript
export default class MainScene extends Phaser.Scene {
  create() {
    // Launch game scene
    this.scene.launch('TowerDefenseScene');
    // Launch UI overlay
    this.scene.launch('UIScene');
  }
}
```

### Option 2: Use Scene Manager

In UIScene.scene settings:
1. Set **preloadPackFiles** to include your asset pack
2. Add TowerDefenseScene to the scene chain

---

## Debugging in Phaser Editor

### Console Logging
Add debug statements in your scene:
```typescript
console.log('Button clicked!', this.gold);
```

View output in:
- **Phaser Editor Console** (bottom panel)
- **Browser DevTools** (F12 in preview window)

### Scene Debugging
```typescript
// Check if scenes are running
console.log('Active scenes:', this.scene.manager.scenes);

// Check UI scene reference
console.log('UI Scene:', this.scene.get('UIScene'));
```

---

## Making UI Elements Interactive

In Phaser Editor, to make elements clickable:

### Rectangles/Images:
After Phaser Editor generates the code, add in `create()`:
```typescript
this.waveButton.setInteractive({ cursor: 'pointer' });
this.waveButton.on('pointerdown', this.onWaveButtonClick, this);
this.waveButton.on('pointerover', () => {
  this.waveButton.setAlpha(0.8); // Hover effect
});
this.waveButton.on('pointerout', () => {
  this.waveButton.setAlpha(1);
});
```

### Text Objects:
```typescript
this.ballistaCostText.setInteractive({ cursor: 'pointer' });
this.ballistaCostText.on('pointerdown', () => {
  this.events.emit('selectTower', 'basic');
});
```

---

## Asset Loading Best Practices

### In UIScene.scene settings:
1. Go to **Scene Settings** (gear icon)
2. Under **"Preload Pack Files"**, add your asset pack:
   - Click **"+"**
   - Select `asset-pack.json`
   - This ensures assets load before the scene starts

### Referencing Assets in UI:
Instead of colored rectangles, use actual sprites:
```typescript
// In Phaser Editor, change Rectangle to Image
// Set texture key to match asset pack (e.g., "icon_ballista")
```

---

## Live Reload Workflow

1. **Edit Scene** in Phaser Editor → Save
2. Phaser Editor **auto-generates** UIScene.ts
3. **Refresh preview** (F5 in preview window)
4. Changes appear immediately

**Pro Tip**: Keep preview window open while editing for instant feedback!

---

## Common Issues & Solutions

### Issue: "Scene not found"
**Solution**: Make sure both scenes are registered in your game config:
```typescript
scene: [TowerDefenseScene, UIScene]
```

### Issue: "Cannot read property 'setText' of undefined"
**Solution**: UI element doesn't exist. Check:
- Element has correct `id` in UIScene.scene
- TypeScript was regenerated
- Element is created before you access it

### Issue: "Button not clickable"
**Solution**: Add `.setInteractive()` in create() method:
```typescript
this.waveButton.setInteractive();
```

### Issue: Changes not appearing
**Solution**:
1. Save the .scene file
2. Check if UIScene.ts was regenerated (check timestamp)
3. Refresh preview window
4. Clear browser cache if needed

---

## Next Steps

### Current Status:
- ✅ Assets loaded in asset pack
- ✅ UI scene created visually
- ⏳ Event handlers need to be added
- ⏳ Game scene integration

### To Complete Integration:
1. **Compile UIScene** → Generate fresh UIScene.ts
2. **Add event handlers** in create() method
3. **Update game scene** to launch UIScene
4. **Test in Phaser Editor** preview
5. **Test in npm run dev** for full integration

---

## Resources

- [Phaser Editor Docs](https://phasereditor2d.com/docs/)
- [Phaser 3 Scene Documentation](https://photonstorm.github.io/phaser3-docs/Phaser.Scene.html)
- [Scene Communication](https://phaser.io/examples/v3/view/scenes/communication)
- [Asset Pack Format](https://photonstorm.github.io/phaser3-docs/Phaser.Loader.LoaderPlugin.html#pack)

---

**Last Updated**: 2025-11-15
